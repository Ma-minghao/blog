# 进程管理

## 进程

资源分配的单位

在一个进程的活动期间至少具备三种基本状态，即运行状态、就绪状态、阻塞状态（等待事件，比如读硬盘）

当进程处于挂起状态时可以将进程使用的物理内容换出到 Swap 空间中

![process status](https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E8%BF%9B%E7%A8%8B%E5%92%8C%E7%BA%BF%E7%A8%8B/10-%E8%BF%9B%E7%A8%8B%E4%B8%83%E4%B8%AD%E7%8A%B6%E6%80%81.jpg)

具有相同状态的进程链在一起，组成各种队列，如：就绪队列、运行队列、阻塞队列

进程的上下文切换不仅包含了虚拟内存、栈、全局变量等用户空间的资源，还包括了内核堆栈、寄存器等内核空间的资源。

## 线程

CPU 调度的单位

线程之间可以并发运行且共享进程的资源

## 进程间通信

- 管道：`|` 将两个命令连接起来，可以使用 `mkfifo` 创建命名管道
- 消息队列：保存在内核中的消息链表，消息队列通信过程中，存在用户态与内核态之间的数据拷贝开销
- 共享内存：共享内存的机制，就是拿出一块虚拟地址空间来，映射到相同的物理内存中
- 信号量（P V 操作）：信号量其实是一个整型的计数器，主要用于实现进程间的互斥与同步，为了防止多进程竞争共享资源，而造成的数据错乱
- 信号：比如 `SIGINT` 信号
- Socket：网络通信

## 死锁

当两个线程为了保护两个不同的共享资源而使用了两个互斥锁

![](https://cdn.xiaolincoding.com/gh/xiaolincoder/ImageHost4@main/%E6%93%8D%E4%BD%9C%E7%B3%BB%E7%BB%9F/%E6%AD%BB%E9%94%81/%E7%8E%AF%E8%B7%AF%E7%AD%89%E5%BE%85%E6%9D%A1%E4%BB%B6.png)

产生死锁的四个必要条件是：互斥条件、持有并等待条件、不可剥夺条件、环路等待条件

避免死锁的方法：

- 所有的线程都按顺序访问资源

## 互斥锁与自旋锁

- 互斥锁加锁失败后，线程会释放 CPU ，给其他线程

- 自旋锁加锁失败后，线程会忙等待，直到它拿到锁
